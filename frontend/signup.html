<!DOCTYPE html>
<html>
<head><title>Signup</title></head>
<body>
  <h2>Signup</h2>
  <form id="signupForm">
    <input name="name" placeholder="Name" />
    <input name="email" placeholder="Email" type="email" />
    <input name="password" placeholder="Pwd" type="password" />
    <button>Sign Up</button>
  </form>
  <script type="module">
    import { apiFetch, setToken } from './auth.js';
    document.getElementById('signupForm').onsubmit = async e => {
      e.preventDefault();
      const form = e.target;
      const data = {
        name: form.name.value,
        email: form.email.value,
        password: form.password.value,
        role: 'buyer'  // default
      };
      try {
        const res = await apiFetch('/api/auth/register', {
          method: 'POST',
          body: JSON.stringify(data)
        });
        setToken(res.token);
        alert('Signed up successfully!');
        location = 'listings.html';
      } catch (err) {
        alert(err.message);
      }
    };
  </script>
</body>
</html>
